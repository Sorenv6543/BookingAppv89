---
description: 
globs: 
alwaysApply: true
---
# Cursor AI IDE Rules - Production-Ready Property Cleaning Scheduler

> **PROJECT STATUS**: üöÄ **PRODUCTION READY** - 95% Complete, Role-Based Architecture Fully Implemented
> 
> Read @project_summary.md for **role-based multi-tenant architecture** overview
> Check @tasks.md for **current completion status** and remaining priorities  
> Reference @repomix-output.md for **existing implementations** and patterns

---

## üéØ **CURRENT PROJECT PHASE: FINALIZATION & OPTIMIZATION**

### **IMMEDIATE FOCUS AREAS**
1. **TypeScript Cleanup**: Final 5% compilation optimization (20 minor warnings remaining)
2. **Performance Monitoring**: Role-based data access performance optimization  
3. **Documentation**: Component API documentation and deployment guides
4. **Quality Assurance**: Maintaining 100% test pass rate (53/53 tests)
5. **Security Preparation**: Document frontend vs backend security boundaries

### **‚ö†Ô∏è CRITICAL PRODUCTION CONSTRAINTS**
- **DO NOT** break existing role-based architecture patterns
- **DO NOT** modify core shared stores (property.ts, booking.ts, user.ts, ui.ts)
- **DO NOT** change established component communication patterns
- **MAINTAIN** 100% test pass rate - verify after any changes
- **PRESERVE** performance optimizations (67% reduction in reactive subscriptions)

---

## üèóÔ∏è **ESTABLISHED ARCHITECTURE PATTERNS** *(Do Not Break)*

### **1. Role-Based Multi-Tenant Architecture** ‚úÖ **PRODUCTION READY**
```typescript
// ESTABLISHED PATTERN: Role-specific data scoping
// Owner Interface: Personal data only (30-40 property owner clients)
const useOwnerBookings = () => {
  const myBookings = computed(() => 
    Array.from(bookingStore.bookings.values())
      .filter(booking => booking.owner_id === currentUser.id)
  );
};

// Admin Interface: System-wide data access  
const useAdminBookings = () => {
  const allBookings = computed(() => 
    Array.from(bookingStore.bookings.values()) // No filtering - all data
  );
};
```

### **2. Component Architecture Layers** ‚úÖ **PRODUCTION READY**
```
ESTABLISHED STRUCTURE:
components/
‚îú‚îÄ‚îÄ dumb/
‚îÇ   ‚îú‚îÄ‚îÄ shared/          # ‚úÖ Reusable across roles (PropertyCard, TurnAlerts)
‚îÇ   ‚îú‚îÄ‚îÄ owner/           # ‚úÖ Owner-specific UI (OwnerBookingForm, OwnerCalendarControls)  
‚îÇ   ‚îî‚îÄ‚îÄ admin/           # ‚úÖ Admin-specific UI (AdminBookingForm, CleanerAssignmentModal)
‚îî‚îÄ‚îÄ smart/
    ‚îú‚îÄ‚îÄ owner/           # ‚úÖ Owner orchestrators (HomeOwner, OwnerSidebar, OwnerCalendar)
    ‚îî‚îÄ‚îÄ admin/           # ‚úÖ Admin orchestrators (HomeAdmin, AdminSidebar, AdminCalendar)
```

### **3. Performance-Optimized Composables** ‚úÖ **PRODUCTION READY**
```typescript
// ESTABLISHED PATTERN: Three-layer composables architecture
// Layer 1: Shared foundation (useAuth, useBookings, useProperties)
// Layer 2: Role-specific data access (useOwnerBookings, useAdminBookings)  
// Layer 3: Performance caching (Single store subscription, cached computations)

// ‚úÖ VERIFIED PERFORMANCE GAINS:
// - 67% reduction in reactive subscriptions (120 ‚Üí 40)
// - 60% reduction in memory usage  
// - 70% reduction in CPU load
// - 25% improvement in mobile battery life
```

### **4. Map Collections Performance Pattern** ‚úÖ **PRODUCTION READY**
```typescript
// ESTABLISHED PATTERN: All stores use Map<string, T> for O(1) lookups
properties: Map<string, Property> = new Map()  // Used by both roles
bookings: Map<string, Booking> = new Map()     // Filtered per role  
users: Map<string, User> = new Map()           // Role-based routing

// ‚úÖ USE MAP METHODS for efficiency:
.has(), .get(), .set(), .delete(), .forEach()
// Return Map objects, not Arrays (provide Array getters only when needed)
```

---

## üìã **DEVELOPMENT WORKFLOW** *(Maintenance Mode)*

### **For Any Code Changes:**

#### **1. Pre-Change Verification**
```bash
# ‚úÖ REQUIRED: Verify current state before changes
pnpm type-check    # Should show only ~20 minor warnings
pnpm test         # Should show 53/53 tests passing  
pnpm build        # Should complete in ~17.47s
```

#### **2. Context Research Pattern**
```markdown
1. **Context First**: Use Context7 tool to research relevant documentation
   - Reference @context7_techstack_ids.md for tech stack documentation
   - Search for specific patterns (Vue 3 Composition API, Vuetify 3, FullCalendar v6)
   
2. **Sequential Thinking**: Break down the task systematically
   - Consider role-based implications (Owner vs Admin impact)
   - Plan for data scoping requirements
   - Identify shared vs role-specific components
   
3. **Pattern Matching**: Follow established codebase patterns
   - Reference existing implementations in @repomix-output.md
   - Maintain established naming conventions and folder structures
   - Preserve performance optimization patterns
```

#### **3. Implementation Guidelines**

**‚úÖ SAFE TO MODIFY:**
- Demo components in `src/dev/demos/` (testing only)
- Documentation files in `docs/`
- Minor TypeScript error fixes in demo files
- Performance optimization tweaks
- Component API documentation

**‚ö†Ô∏è MODIFY WITH EXTREME CAUTION:**
- Any file in `src/components/smart/` (orchestrators)
- Any file in `src/composables/` (business logic)
- Any file in `src/stores/` (state management)
- Role-based routing in `src/router/`

**üö´ DO NOT MODIFY WITHOUT URGENT NEED:**
- `src/types/` (established interfaces)
- `src/utils/businessLogic.ts` (core business rules)
- Production component communication patterns
- Map collection structures in stores

#### **4. Post-Change Verification**
```bash
# ‚úÖ REQUIRED: Verify after any changes
pnpm type-check    # Should not increase error count
pnpm test         # Should maintain 53/53 tests passing
pnpm build        # Should maintain ~17.47s build time

# ‚úÖ ROLE-BASED VERIFICATION:
# Manual testing: Owner sees only their data
# Manual testing: Admin sees all system data  
# Manual testing: Cross-role updates work correctly
```

---

## üîß **CURRENT TASK PRIORITIES** *(From tasks.md)*

### **TASK-063: TypeScript Cleanup** - 95% Complete ‚úÖ
- **Goal**: Reduce remaining ~20 minor warnings in demo files
- **Status**: All production code is TypeScript-clean
- **Safe Areas**: Only demo components in `src/dev/demos/`
- **Constraint**: Do not modify production component types or interfaces

### **TASK-056: Component API Documentation** - Not Started
- **Goal**: Document role-specific component APIs and usage patterns
- **Focus**: Owner vs Admin component differences
- **Safe Areas**: Documentation files only
- **Output**: API documentation for established components

### **TASK-057: Performance Optimization** - Not Started  
- **Goal**: Monitor and optimize role-specific data filtering performance
- **Focus**: Measurement and monitoring, not architectural changes
- **Safe Areas**: Performance measurement tools, optional optimizations
- **Constraint**: Do not break established performance patterns

---

## üõ°Ô∏è **SECURITY & DATA BOUNDARIES** *(Current Implementation)*

### **Frontend Data Filtering** *(Production Implementation)*
```typescript
// ‚úÖ CURRENT SECURITY MODEL: Frontend filtering for UX optimization
// Owner data scoping (for user experience)
const ownerBookings = computed(() => 
  allBookings.filter(b => b.owner_id === currentUser.id)
);

// ‚ö†Ô∏è SECURITY NOTE: Frontend filtering is NOT security - only UX optimization
// Real security will be implemented via Supabase RLS (Row Level Security) in Phase 2
```

### **Role-Based Access Patterns** *(Established)*
```typescript
// ‚úÖ ESTABLISHED: Owner interface patterns
// - Personal property management
// - Simple booking workflows  
// - Mobile-optimized UI
// - Encouraging error messages

// ‚úÖ ESTABLISHED: Admin interface patterns  
// - System-wide data access
// - Complex business workflows
// - Information-dense desktop UI
// - Technical error messages with business impact
```

---

## üé® **COMPONENT PATTERNS** *(Established - Do Not Break)*

### **Dumb Component Reuse** ‚úÖ **WORKING**
```vue
<!-- ‚úÖ ESTABLISHED PATTERN: Same component, different data scope -->
<TurnAlerts :turns="ownerTurns" />      <!-- Owner: only their turns -->
<TurnAlerts :turns="systemTurns" />     <!-- Admin: all system turns -->

<PropertyCard :property="prop" @edit="handleEdit" />
<!-- Owner: prop = their property, Admin: prop = any property -->
```

### **Smart Component Orchestration** ‚úÖ **WORKING**
```vue
<!-- ‚úÖ ESTABLISHED: Role-specific orchestrators -->
<HomeOwner />   <!-- Optimized for personal property management -->
<HomeAdmin />   <!-- Optimized for business operations -->

<!-- ‚ùå AVOID: Do not create generic components with role props -->
<Home :userRole="role" :showAdminFeatures="isAdmin" />  <!-- Bad pattern -->
```

### **Component Communication Flow** ‚úÖ **WORKING**
```
Owner Flow: OwnerSidebar ‚Üí HomeOwner ‚Üí OwnerCalendar (Personal data, simple actions)
Admin Flow: AdminSidebar ‚Üí HomeAdmin ‚Üí AdminCalendar (System data, complex actions)
```

---

## üìä **TESTING PATTERNS** *(100% Pass Rate - Maintain)*

### **Role-Based Data Isolation Testing** ‚úÖ **PASSING**
```typescript
// ‚úÖ ESTABLISHED TESTS: Owner data filtering
describe('useOwnerBookings', () => {
  it('should return only current owner bookings', () => {
    const { myBookings } = useOwnerBookings();
    expect(myBookings.value.every(b => b.owner_id === currentUser.id)).toBe(true);
  });
});

// ‚úÖ ESTABLISHED TESTS: Admin system access
describe('useAdminBookings', () => {
  it('should return all bookings without filtering', () => {
    const { allBookings } = useAdminBookings();
    expect(allBookings.value.length).toBe(mockAllBookings.length);
  });
});
```

### **Cross-Role Integration Testing** ‚úÖ **PASSING**
```typescript
// ‚úÖ ESTABLISHED TESTS: Multi-tenant data updates
describe('Cross-role data visibility', () => {
  it('should show owner booking in admin interface', () => {
    // Owner creates booking ‚Üí Admin should see it in system view
  });
});
```

---

## üöÄ **BUILD & DEPLOYMENT** *(Production Ready)*

### **Optimized Build Configuration** ‚úÖ **WORKING**
```typescript
// ‚úÖ ESTABLISHED: Role-based chunking (18 optimized chunks)
// - admin-components (169KB), owner-components (59KB), shared-ui (84KB)
// - admin-logic (54KB), owner-logic (19KB), shared-logic (33KB)
// - Core libraries: vuetify (874KB), vue-core (683KB), calendar (581KB)

// ‚úÖ AVAILABLE BUILD MODES:
pnpm build            # Full production build
pnpm build:owner      # Owner-only build  
pnpm build:admin      # Admin-only build
```

### **Deployment Readiness** ‚úÖ **COMPLETE**
- ‚úÖ Build time: ~17.47s (optimized)
- ‚úÖ TypeScript: Production-clean compilation
- ‚úÖ Testing: 100% pass rate (53/53 tests)
- ‚úÖ Documentation: Complete deployment guides
- ‚úÖ Performance: Mobile PWA optimized

---

## üìù **NAMING CONVENTIONS** *(Established - Follow Exactly)*

### **Component Naming** ‚úÖ **ESTABLISHED**
```
Owner Components: Owner prefix (OwnerSidebar.vue, OwnerCalendar.vue)
Admin Components: Admin prefix (AdminSidebar.vue, AdminCalendar.vue)  
Shared Components: No prefix (PropertyCard.vue, TurnAlerts.vue)
```

### **Composable Naming** ‚úÖ **ESTABLISHED**
```
Owner Composables: useOwner prefix (useOwnerBookings.ts, useOwnerProperties.ts)
Admin Composables: useAdmin prefix (useAdminBookings.ts, useCleanerManagement.ts)
Shared Composables: use prefix (useAuth.ts, useValidation.ts)
```

### **File Structure** ‚úÖ **ESTABLISHED**
```
Stores: camelCase (property.ts, booking.ts, ui.ts)
Types: camelCase (booking.ts, property.ts, ui.ts)  
Utils: camelCase (businessLogic.ts, authHelpers.ts)
Pages: camelCase (index.vue, dashboard.vue)
```

---

## üîç **CODE QUALITY CHECKLIST** *(Before Marking Any Task Complete)*

### **Standard Checks** ‚úÖ **REQUIRED**
- [ ] TypeScript compiles without NEW errors (maintain ~20 minor demo warnings)
- [ ] Follows established naming conventions exactly
- [ ] Integrates with existing stores/composables without breaking patterns
- [ ] Includes appropriate error handling for role
- [ ] Maintains existing performance optimization patterns

### **Role-Based Checks** ‚úÖ **REQUIRED**  
- [ ] **Data Scoping**: Owner components filter to user's data only
- [ ] **Admin Access**: Admin components access all data without filtering
- [ ] **Performance**: Does not increase reactive subscription count
- [ ] **Security Documentation**: Notes frontend vs backend security boundaries
- [ ] **Test Coverage**: Maintains 100% test pass rate
- [ ] **Cross-Role Compatibility**: Changes work for both owner and admin interfaces

### **Production Readiness Checks** ‚úÖ **REQUIRED**
- [ ] **Build Performance**: Maintains ~17.47s build time
- [ ] **Bundle Optimization**: Does not significantly increase chunk sizes
- [ ] **Mobile Performance**: Maintains mobile PWA optimization
- [ ] **Backward Compatibility**: Does not break existing role-based routing
- [ ] **Documentation**: Updates relevant API documentation

---

## üìö **REFERENCE DOCUMENTATION** *(Project Knowledge Base)*

### **Architecture & Patterns**
- **@project_summary.md**: Complete role-based multi-tenant architecture overview
- **@tasks.md**: Current completion status and next priorities
- **@repomix-output.md**: Existing implementations and code patterns

### **Technical Documentation**
- **docs/references/component_orchestration_reference.md**: Smart component patterns
- **docs/references/business_logic_reference.md**: Shared business rules  
- **docs/references/vue_typescript_reference.md**: Vue 3 + TypeScript patterns
- **docs/references/vuetify_typescript_reference.md**: Vuetify 3 + TypeScript patterns

### **Context7 Tech Stack IDs**
- **@context7_techstack_ids.md**: Documentation library IDs for research
- Use Context7 tool for Vue 3, Vuetify 3, FullCalendar v6, Pinia, TypeScript research

---

## üéØ **SUCCESS METRICS** *(Maintain Current Levels)*

### **Performance Metrics** ‚úÖ **ACHIEVED**
- **Reactive Subscriptions**: 67% reduction maintained (120 ‚Üí 40)
- **Memory Usage**: 60% reduction in computed property duplication  
- **CPU Load**: 70% reduction in redundant filtering operations
- **Mobile Battery**: 25% improvement maintained
- **Build Time**: ~17.47s maintained

### **Quality Metrics** ‚úÖ **ACHIEVED**
- **Test Coverage**: 100% pass rate (53/53 tests)
- **TypeScript**: Production code 100% clean compilation
- **Role Isolation**: Perfect data scoping for owner/admin interfaces
- **Component Reuse**: Optimal shared/role-specific component balance

### **Business Readiness** ‚úÖ **ACHIEVED**
- **Multi-Tenant Ready**: 30-40 property owner clients + 1 admin interface
- **Security Prepared**: Frontend filtering documented, backend RLS planned
- **Deployment Ready**: Complete build optimization and deployment guides
- **Scalability Proven**: Can handle 100+ concurrent users

---

## ‚ö° **QUICK REFERENCE** *(Emergency Patterns)*

### **Role Responsibility Boundaries** *(DO NOT CROSS)*
```typescript
// ‚úÖ OWNER INTERFACE (30-40 clients):
// - Purpose: Personal property and booking management
// - Data: Only their properties and bookings (owner_id filtering)
// - Features: Simple workflows, mobile-optimized
// - Turn Alerts: Only their urgent turns

// ‚úÖ ADMIN INTERFACE (1 user):  
// - Purpose: System-wide business management
// - Data: All properties and bookings (no filtering)
// - Features: Complex workflows, cleaner assignment, analytics
// - Turn Alerts: System-wide urgent turns across all clients
```

### **Emergency Debugging** *(Production Issues)*
```bash
# Role-based data isolation check:
console.log('Owner bookings:', useOwnerBookings().myBookings.value.length)
console.log('Admin bookings:', useAdminBookings().allBookings.value.length)
# Owner count should be <= Admin count

# Performance monitoring:
console.log('Reactive subscriptions:', /* count active subscriptions */)
# Should be ~40, not 120+

# Test verification:
pnpm test  # Should show 53/53 passing
```

---

**üöÄ REMEMBER: This is a PRODUCTION-READY project at 95% completion. Focus on finalization, optimization, and documentation rather than major architectural changes.** 